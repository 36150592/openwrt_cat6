<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<script type="text/javascript">
    $(document).ready(function() {
        var opts = {
            cn: {
                lockTh: '锁物理小区',
                lockCurrent: '锁定当前物理小区',
                lockSpecific: '锁定指定物理小区',
                unlock: '解锁',
                lockedStatus: {th:'锁定状态', locked:'已锁定', unlocked: '未锁定'},
                enodeBId: 'EnodeB ID',
                freqPoint: '频点',
                phyCellId: '物理小区ID',
                btnSave: '确 定',
                readFail: '获取数据失败',

                lockSuccess: '锁定成功!',
                lockFail: '锁定失败!',
                unlockSuccess: '解锁成功!',
                unlockFail: '解锁失败!',
                confirmUnlock: '您确定要解锁吗?',
                serverIpEmpty: '网管服务器地址为空，请在高级设置页面设置网管服务器地址。',
                authFail: '网管服务器禁止锁物理小区，请联系管理员。',
                only4G: '您必须将网络工作模式设置为“只在4G模式下工作”，请前往【设备配置】->【WAN 配置】->【选网方式】->【工作模式】进行设置。'
            },
            en: {
                lockTh: 'Lock Physical Cell',
                lockCurrent: 'Lock Current Physical Cell',
                lockSpecific: 'Lock Specific Physical Cell',
                unlock: 'Unlock',
                lockedStatus: {th:'Locked Status', locked:'Locked', unlocked: 'Unlocked'},
                enodeBId: 'EnodeB ID',
                freqPoint: 'EARFCN',
                phyCellId: 'Physical Cell ID',
                btnSave: 'Apply',
                readFail: 'Read failed.',

                lockSuccess: 'Locking success.',
                lockFail: 'Locking fail.',
                unlockSuccess: 'Unlocking success.',
                unlockFail: 'Unlocking fail.',
                confirmUnlock: 'Are you sure you want to unlock physical cell?',
                serverIpEmpty: 'The server address is empty, please set the server address in advanced setting page.',
                authFail: 'You have not rights to lock physical cell.',
                only4G: 'You must set the network Working Mode as "Only 4G" first, please forward to Device Setting->WAN Setting->Network Mode->Working Mode'
            }
        };
        var lang = MasterPage.init(opts);

        var $trSave = $('#trSave'),
            $btnSave = $('#btnSave'),
            $locks = $('.lock').hide(),
            $spanLockedStatus = $('#spanLockedStatus'),
            $lockTypes = $('input[name=lockType]');

        var lockType = -1;
        var lockedStatus = -1;
        var currentFreqPoint = "", currentPhyCellId = "";
        var lockedFreqPoint = "", lockedPhyCellId = "";

        function showInfo() {
            if (lockedStatus == 1) {
                $spanLockedStatus.html(lang.lockedStatus.locked);
                InputUtil.setRadiosSelectedValue($lockTypes, lockType);
                if(lockType == 2){
                    $('#txtFreqPoint').val(lockedFreqPoint);
                    $('#txtPhyCellId').val(lockedPhyCellId);
                    $locks.show();
                }
                $trSave.show();
            }else {
                $spanLockedStatus.html(lang.lockedStatus.unlocked);
            }
        }

        function getInfo() {
            Page.postJSON({
                json: {
                    cmd: RequestCmd.LOCK_ONE_CELL
                },
                success: function(datas) {
                      console.log(datas);
                      if(datas.lockceel != '' && datas.modem != ''){
                          lockedStatus = 1;
                          var lockceelArr=datas.lockceel.split(",");
                          lockedPhyCellId = lockceelArr[0];
                          lockedFreqPoint = lockceelArr[1];
                          currentPhyCellId = datas.modem.pci;
                          currentFreqPoint = datas.modem.earfcn;
                          if(lockceelArr[0] == datas.modem.pci){
                              lockType = 1;
                          }else {
                              lockType = 2;
                          }
                      }

                },
                complete: function() {
                    showInfo();
                }
            });
        }

        getInfo();

     });
</script>

<div class="tab_box" id="child_container">
    <script type="text/template" id="child_template">
        <form id="lockPhyCellForm">
            <table id="lockPhyCellTable" class="detail" cellspacing="0">
                <tr>
                    <th><%- lockedStatus.th %><%- colon %></th>
                    <td><span id="spanLockedStatus"></span></td>
                </tr>
                <tr>
                    <th><%- lockTh %><%- colon %></th>
                    <td>
                        <input type="radio" name="lockType" value="0" /><%= lockCurrent %>&nbsp;&nbsp;
                        <input type="radio" name="lockType" value="1" /><%= lockSpecific %>&nbsp;&nbsp;
                    </td>
                </tr>
                <tr class="lock">
                    <th><%- freqPoint %><%- colon %></th>
                    <td><input type="text" id="txtFreqPoint" name="txtFreqPoint" /></td>
                </tr>
                <tr class="lock">
                    <th><%- phyCellId %><%- colon %></th>
                    <td><input type="text" id="txtPhyCellId" name="txtPhyCellId" /></td>
                </tr>
                <tr id="trSave">
                    <th>&nbsp;</th>
                    <td>
                        <input type="button" id="btnSave" value="<%- btnSave %>"/>
                    </td>
                </tr>
            </table>
        </form>
    </script>
</div>

