<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<script type="text/javascript">
    $(document).ready(function() {
        Page.render();
        Page.setStripeTable();

        function getDateTime() {
            return new Date().format('yyyy-mm-dd HH:MM');
        }

        Page.postJSON({
            json:{
                cmd: RequestCmd.SET_DATETIME,
                method: JSONMethod.GET
            },
            success: function(data){
                $('#lblTime').text(data.systime);
                $('#timeServer').val(FormatUtil.formatField(data.timeServer).trim());
                $('#timeServer2').val(FormatUtil.formatField(data.timeServer2).trim());
                $('#timeServer3').val(FormatUtil.formatField(data.timeServer3).trim());
                $('#timezone').val(data.timezone);
            }
        });

        var $datetime = $('#datetime').val(getDateTime()).keypress(function(e) {
            if(e.keyCode == 13){
                return false;
            }
        });

        //$('#timezone').html(Timezone.getAllZones());

        $('#autoTime').bind('click', function() {
            $datetime.val(getDateTime());
        });


        var rules = {
                datetime: { required: true, datetime: true }
            },
            messages = {
                datetime: { required: CHECK.required.systemTime, datetime: CHECK.format.systemTime }
            };

        var $btnSave = $('#btnSave');
        $btnSave.bind('click', function() {
            var $form = $('#form1');
            if(!CheckUtil.checkForm($form, rules, messages)){
                return false;
            }

            var json = JSON.parmsToJSON($form);
            json.method = JSONMethod.POST;
            json.cmd = RequestCmd.SET_DATETIME;

            try {
                var theDateTime = json.datetime;
                var datetime = theDateTime.replace(/[\-|\:|\s]/g, "");
                json.datetime = datetime.slice(4) + datetime.substring(0, 4);

                Page.postJSON({
                    $id: $btnSave,
                    json: json,
                    success: function(data) {
                        $('#lblTime').text(theDateTime + ":00");
                        AlertUtil.alertMsg(PROMPT.saving.systemTime);
                    }
                });
            } catch (ex) {
                AlertUtil.alertMsg(CHECK.format.systemTime);
            }
        });
    });
</script>

<div class="tab_box" id="child_container">
    <script type="text/template" id="child_template">
        <form id="form1">
            <table class="detail" cellspacing="0">
                <tr>
                    <th><%- sys.systemTime %><%- colon %></th>
                    <td><label id="lblTime"></label></td>
                </tr>
                <tr>
                    <th><%- sys.timezone %><%- colon %></th>
                    <td><input type="text" id="timezone" name="timezone" class="large" maxlength="100" /></td>
                </tr>
                <tr>
                    <th><%- sys.ntp %>1<%- colon %></th>
                    <td><input type="text" id="timeServer" name="timeServer" class="large" maxlength="100" /></td>
                </tr>
                <tr>
                    <th><%- sys.ntp %>2<%- colon %></th>
                    <td><input type="text" id="timeServer2" name="timeServer2" class="large" maxlength="100" /></td>
                </tr>
                <tr>
                    <th><%- sys.ntp %>3<%- colon %></th>
                    <td><input type="text" id="timeServer3" name="timeServer3" class="large" maxlength="100" /></td>
                </tr>
                <tr>
                    <th><%- sys.clientTime %><%- colon %></th>
                    <td>
                        <input type="text" id="datetime" name="datetime" class="normal" maxlength="20" />&nbsp;&nbsp;
                        <input type="button" id="autoTime" value="<%- btn.getClientTime %>"/>
                    </td>
                </tr>
                <tr>
                    <th>&nbsp;</th>
                    <td><input type="button" id="btnSave" value="<%- btn.save %>"/></td>
                </tr>
            </table>
        </form>
    </script>
</div>

